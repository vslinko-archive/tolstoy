<!DOCTYPE html>

<html>
<head>
  <title>Substring iterator</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>Substring iterator</h1>
<h3>Example:</h3>
<pre><code class="lang-coffee">it = new SubstringIterator &quot;abba&quot;
it.forEach (substring) -&gt;
  console.log substring</code></pre>
<h3>Output:</h3>
<pre><code>abba
abb
bba
ab
bb
ba
a
b
b
a</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">SubstringIterator</span></span>
  constructor: (<span class="property">@string</span>) -&gt;
    <span class="property">@length</span> = <span class="property">@string</span>.length
    <span class="property">@occurrences</span> = <span class="number">1</span>

  forEach: (callback) -&gt;
    <span class="keyword">while</span> <span class="property">@length</span> &gt; <span class="number">0</span>
      <span class="keyword">for</span> pos <span class="keyword">in</span> [<span class="number">0.</span>..<span class="property">@occurrences</span>]
        res = callback <span class="property">@string</span>.substr pos, <span class="property">@length</span>
        <span class="keyword">return</span> <span class="keyword">if</span> res <span class="keyword">is</span> <span class="literal">false</span>
      <span class="property">@length</span> -= <span class="number">1</span>
      <span class="property">@occurrences</span> += <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>LCS for multiple strings</h1>
<h3>Example:</h3>
<pre><code class="lang-coffee">console.log mlcs [
  &quot;abacaba&quot;
  &quot;mycabarchive&quot;
  &quot;acabistrue&quot;
]</code></pre>
<h3>Output:</h3>
<pre><code>cab</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">mlcs</span></span> = (strings) -&gt;
  <span class="keyword">return</span> <span class="literal">false</span> <span class="keyword">if</span> strings.length &lt; <span class="number">2</span>

  strings.sort (a, b) -&gt;
    a.length &gt; b.length

  firstString = strings.shift()
  result = <span class="literal">false</span>

  substrings = <span class="keyword">new</span> SubstringIterator firstString
  substrings.forEach (substring) -&gt;
    <span class="keyword">for</span> string <span class="keyword">in</span> strings
      <span class="keyword">return</span> <span class="keyword">if</span> string.indexOf(substring) == -<span class="number">1</span>
    result = substring
    <span class="keyword">return</span> <span class="literal">false</span>

  result</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h1>STDIN line reader</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">inputReader</span></span> = (callback) -&gt;
  buffer = <span class="string">""</span>

  process.stdin.resume()
  process.stdin.<span class="literal">on</span> <span class="string">"data"</span>, (data) -&gt;
    chunk = buffer + data.toString()

    <span class="keyword">if</span> chunk.indexOf(<span class="string">"\n"</span>) &gt;= <span class="number">0</span>
      frames = chunk.split <span class="string">"\n"</span>
      chunk = frames.pop()

      <span class="keyword">for</span> frame <span class="keyword">in</span> frames
        callback frame

    buffer = chunk</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h1>Main function</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">do</span> <span class="function"><span class="title">main</span></span> = -&gt;
  length = <span class="literal">null</span>
  strings = []

  inputReader (line) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>expect length in first line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">unless</span> length
      length = Number(line)

      <span class="keyword">unless</span> length
        process.stderr.write <span class="string">"Invalid input\n"</span>
        process.exit <span class="number">1</span>

      <span class="keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>save next lines in array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    strings.push line</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>calculate mlcs if <code>length</code> lines provided</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> strings.length == length
      process.stdin.pause()

      result = mlcs strings
      <span class="keyword">return</span> process.exit(<span class="number">2</span>) <span class="keyword">unless</span> result

      process.stdout.write result
      process.stdout.write <span class="string">"\n"</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
